<!DOCTYPE html>
<html lang="en">
<!--
Single-file, browser-only S3 File Manager
Primary deliverable: [index.html](index.html)
AWS SDK v2 pinned version: 2.1488.0

Usage notes:
- This single HTML file runs entirely client-side. It uses the CDN-delivered AWS SDK v2 to call S3 directly via [AWS.S3()].
- Configure credentials with [AWS.config.update()], then instantiate a client [AWS.S3({ signatureVersion: 'v4' })].
- Operations used: [S3.listObjectsV2()], [S3.getObject()], [S3.putObject()], [S3.upload()], [S3.deleteObject()], [S3.deleteObjects()].
- Local file origin: Some browser/policy combinations block null-origin requests. If blocked, serve locally via loopback:
  - Example: `python3 -m http.server` then open http://localhost:8000/
  - Keep usage on a trusted machine/profile; credentials are in-memory only and purged on sign-out.

Security reminders:
- Secrets are never persisted; they remain in memory until sign-out or page close.
- Secret access key is never logged or rendered in UI.
-->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Early theme init to prevent flash of wrong theme -->
  <script>
    (function () {
      try {
        var stored = localStorage.getItem('theme');
        var theme = stored || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
      } catch (e) {}
    })();
  </script>
  <title>S3 Explorer</title>
  <link rel="stylesheet" href="assets/css/styles.css">
  <!-- AWS SDK v2 pinned to exact version for determinism -->
  <!-- Version: 2.1488.0 -->
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1488.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="assets/js/favicon.js"></script>
</head>
<body>
  <!-- Minimal global header: theme toggle available before connect -->
  <header class="top-header" aria-label="Global header">
    <span class="project-title" id="projectTitle">S3 Explorer</span>
    <button id="signOutBtn" class="btn btn-ghost" title="Sign Out" aria-label="Sign Out" hidden>Sign Out</button>
    <button id="themeToggleTop" class="btn btn-ghost theme-toggle" aria-pressed="false" aria-label="Theme: Light" title="Toggle theme" onclick="__toggleTheme()"><!-- icon set by JS --></button>
  </header>

  <div class="toast-container" aria-live="polite" aria-atomic="true"></div>
  <button id="infoFab" class="info-fab" title="Requirements" aria-label="Requirements">?</button>

  <div class="container">
    <div class="banner" role="note" aria-label="First-use security guidance">
      <strong>Security reminder:</strong> Use trusted machines and profiles only.
    </div>

    <!-- Connection Form -->
    <section id="connect-card" class="card" aria-labelledby="connect-title">
      <div class="form-grid">
        <div>
          <label for="accessKeyId">Access Key ID</label>
          <input type="text" id="accessKeyId" class="form-input" autocomplete="on" placeholder="AKI***" spellcheck="false" />
          <div id="accessKeyIdError" class="error-text" hidden></div>
        </div>
        <div>
          <label for="secretAccessKey">Secret Access Key</label>
          <input type="password" id="secretAccessKey" class="form-input" placeholder="******" autocomplete="off" />
          <div id="secretAccessKeyError" class="error-text" hidden></div>
        </div>
        <div>
          <label for="region">Region</label>
          <input type="text" id="region" class="form-input" placeholder="e.g., eu-west-1" autocomplete="on" spellcheck="false" />
          <div id="regionError" class="error-text" hidden></div>
        </div>
        <div>
          <label for="bucket">Bucket</label>
          <input type="text" id="bucket" class="form-input" placeholder="e.g., my-s3-bucket" autocomplete="on" spellcheck="false" />
          <div id="bucketError" class="error-text" hidden></div>
        </div>
      </div>
      <div class="actions">
        <button id="connectBtn" class="btn btn-primary" disabled>Connect</button>
      </div>
      <div id="connectGeneralError" class="inline-banner error" hidden role="alert"></div>
    </section>

    <!-- Main App Region (hidden until connected) -->
    <section id="app" hidden>
      <div class="header">
        <nav class="breadcrumbs" aria-label="Breadcrumb">
          <a href="#" data-prefix="" id="crumb-root">/</a>
          <span class="crumb-sep" aria-hidden="true">›</span>
          <span id="crumbs"></span>
        </nav>
        <div class="conn-indicator">
          <span class="conn-item"><span id="connBucket"></span></span>
          <span class="conn-sep">•</span>
          <span class="conn-item"><span id="connRegion"></span></span>
        </div>
      </div>

      <!-- Toolbar -->
      <div class="toolbar" role="toolbar" aria-label="Primary actions">
        <div class="toolbar-left">
          <input id="filterInput" class="search-input" type="text" placeholder="Filter current page…" aria-label="Filter current page" />
          <button id="clearFilterBtn" class="btn btn-ghost" disabled>Clear</button>
        </div>
        <div class="toolbar-right">
          <button id="uploadBtn" class="btn btn-primary">
            Upload
          </button>
          <button id="createDirBtn" class="btn btn-secondary">
            <svg fill="#000000" width="24px" height="20px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd"
              d="M19,19 L19,17 L21,17 L21,19 L23,19 L23,21 L21,21 L21,23 L19,23 L19,21 L17,21 L17,19 L19,19 Z M3,9 L21,9 L21,7 L11.994646,6.99998567 C11.2764915,6.99614058 10.8086916,6.65990923 10.3058322,6.03654146 C10.2364281,5.95050497 10.0158737,5.66440398 9.98159778,5.62115916 C9.60702158,5.14856811 9.38424442,5 9,5 L3,5 L3,9 Z M21,11 L3,11 L3,19 L14,19 L14,21 L3,21 C1.8954305,21 1,20.1045695 1,19 L1,5 C1,3.8954305 1.8954305,3 3,3 L9,3 C10.1200023,3 10.832939,3.47545118 11.5489764,4.37885309 C11.5967547,4.43913352 11.8100999,4.71588275 11.8624831,4.78081945 C12.019726,4.97574495 12.0517795,4.99972956 12.0017863,5 L21,5 C22.1045695,5 23,5.8954305 23,7 L23,15 L21,15 L21,11 Z" />
            </svg>
          </button>
          <button id="downloadBtn" class="btn btn-secondary" disabled>
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8.5 7L8.5 14M8.5 14L11 11M8.5 14L6 11" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M15.5 7L15.5 14M15.5 14L18 11M15.5 14L13 11" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M18 17H12H6" stroke="#000000" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M22 12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2C16.714 2 19.0711 2 20.5355 3.46447C21.5093 4.43821 21.8356 5.80655 21.9449 8" stroke="#000000" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </button>
          <button id="moveBtn" class="btn btn-secondary" disabled>
            <svg fill="#000000" height="24px" width="24px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 492.98 492.98" xml:space="preserve">
              <g>
                <path
                  d="M227.193,167.404H70.18c-16.23,0-29.43,13.189-29.43,29.398v11.383H29.414C13.184,208.186,0,221.373,0,237.598v225.969
              		c0,16.211,13.184,29.414,29.414,29.414h157.014c16.225,0,29.414-13.203,29.414-29.414V452.23h11.352
              		c16.209,0,29.414-13.201,29.414-29.445V196.803C256.608,180.594,243.402,167.404,227.193,167.404z M186.428,208.186H63.039v-11.383
              		c0-3.928,3.184-7.129,7.141-7.129h157.014c3.92,0,7.121,3.201,7.121,7.129v225.982c0,3.941-3.201,7.141-7.121,7.141h-11.352
              		V237.598C215.842,221.373,202.652,208.186,186.428,208.186z M22.287,237.598c0-3.926,3.186-7.121,7.127-7.121h157.014
              		c3.941,0,7.121,3.195,7.121,7.121v225.969c0,3.941-3.18,7.143-7.121,7.143H29.414c-3.941,0-7.127-3.201-7.127-7.143V237.598z" />
                <path d="M66.623,293.863h63.152c6.139,0,11.141-5.016,11.141-11.139c0-6.164-5.002-11.164-11.141-11.164H66.623
              		c-6.127,0-11.145,5-11.145,11.164C55.479,288.848,60.496,293.863,66.623,293.863z" />
                <path d="M66.623,342.447h82.594c6.129,0,11.141-5.002,11.141-11.162c0-6.123-5.012-11.125-11.141-11.125H66.623
              		c-6.127,0-11.145,5.002-11.145,11.125C55.479,337.445,60.496,342.447,66.623,342.447z" />
                <path d="M66.623,390.992h82.594c6.129,0,11.141-4.984,11.141-11.123c0-6.16-5.012-11.164-11.141-11.164H66.623
              		c-6.127,0-11.145,5.004-11.145,11.164C55.479,386.008,60.496,390.992,66.623,390.992z" />
                <path d="M66.623,439.574h82.594c6.129,0,11.141-5.002,11.141-11.131c0-6.156-5.012-11.154-11.141-11.154H66.623
              		c-6.127,0-11.145,4.998-11.145,11.154C55.479,434.572,60.496,439.574,66.623,439.574z" />
                <path
                  d="M482.045,0H303.383c-6.045,0-10.949,4.918-10.949,10.951v77.99h21.885V21.869h156.76v184.322h-29.973
              		c-6.047,0-10.938,4.92-10.938,10.951v29.99h-115.85v-66.51h-21.885v77.445c0,6.016,4.904,10.934,10.949,10.934h137.723
              		c2.891,0,5.66-1.125,7.734-3.199l40.924-40.908c2.09-2.076,3.217-4.822,3.217-7.752V10.951C492.98,4.918,488.076,0,482.045,0z" />
                <path d="M332.488,177.377c0,4.002,2.385,7.559,6.084,9.066c1.188,0.482,2.459,0.74,3.746,0.74c2.654,0,5.131-0.998,6.961-2.861
              		l42.598-42.598c1.848-1.854,2.879-4.328,2.879-6.93c0-2.574-1.061-5.148-2.893-6.98l-42.584-42.551
              		c-2.732-2.752-7.074-3.639-10.723-2.156c-3.684,1.527-6.068,5.1-6.068,9.088v10.482h-66.99c-5.418,0-9.828,4.404-9.828,9.846
              		v44.525c0,5.436,4.41,9.838,9.828,9.838h66.99V177.377z" />
              </g>
            </svg>
          </button>
          <button id="deleteBtn" class="btn btn-destructive" disabled>
            <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M14.5 3L15.5 4H19V6H5V4H8.5L9.5 3H14.5ZM8 21C6.9 21 6 20.1 6 19V7H18V19C18 20.1 17.1 21 16 21H8ZM12 12.59L14.12 10.47L15.53 11.88L13.41 14L15.53 16.12L14.12 17.53L12 15.41L9.88 17.53L8.47 16.12L10.59 14L8.46 11.88L9.87 10.47L12 12.59Z"
                fill="#000000" />
            </svg>
          </button>
          <span id="selectionCount" class="helper" aria-live="polite"></span>
        </div>
      </div>

      <!-- List View -->
      <div class="list" role="table" aria-label="Objects and prefixes">
        <div class="list-header" role="row">
          <div role="columnheader"><input type="checkbox" id="selectAllPage"></div>
          <div role="columnheader">Name</div>
          <div role="columnheader" style="text-align:center">Type</div>
          <div role="columnheader" style="text-align:left">Size</div>
          <div role="columnheader">Last Modified</div>
        </div>
        <div id="rows" role="rowgroup"></div>
        <div id="emptyState" class="empty-state" hidden>
          This path is empty. Try Upload or Create Directory.
        </div>
      </div>

      <button id="loadMoreBtn" class="btn btn-secondary load-more" hidden>Load More</button>
      <div id="listErrorBanner" class="inline-banner error" hidden role="alert"></div>
    </section>
  </div>

  <!-- Upload Modal -->
  <div id="uploadModalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="uploadModalTitle">
    <div class="modal" id="uploadModal" tabindex="-1">
      <div class="modal-header">
        <h3 id="uploadModalTitle">Upload Files</h3>
        <button class="btn btn-ghost" id="closeUploadModalBtn" aria-label="Close">✕</button>
      </div>
      <div class="dropzone" id="dropzone" tabindex="0" aria-label="Drag and drop files here or use the file picker">
        Drag and drop files here, or click to select.
      </div>
      <input type="file" id="filePicker" multiple hidden />
      <div class="actions">
        <button class="btn btn-secondary" id="openFilePickerBtn">Choose Files</button>
      </div>
      <div id="uploadList"></div>
      <div class="modal-actions">
        <button class="btn btn-ghost" id="uploadCloseBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Preview Modal -->
  <div id="previewModalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="previewModalTitle">
    <div class="modal" id="previewModal" tabindex="-1">
      <div class="modal-header">
        <h3 id="previewModalTitle">Preview</h3>
        <button class="btn btn-ghost" id="closePreviewModalBtn" aria-label="Close">✕</button>
      </div>
      <div id="previewContent"></div>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="previewDownloadBtn">Download</button>
        <button class="btn btn-ghost" id="previewCloseBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Create Directory Dialog -->
  <div id="createDirModalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="createDirTitle">
    <div class="modal" id="createDirModal" tabindex="-1">
      <div class="modal-header">
        <h3 id="createDirTitle">Create Directory</h3>
        <button class="btn btn-ghost" id="closeCreateDirModalBtn" aria-label="Close">✕</button>
      </div>
      <label for="dirName">Directory name</label>
      <input type="text" id="dirName" class="form-input" />
      <div class="helper">Allowed characters: letters, numbers, dot, underscore, hyphen.</div>
      <div id="dirNameError" class="error-text" hidden></div>
      <div class="modal-actions">
        <button class="btn btn-primary" id="createDirConfirmBtn">Create</button>
        <button class="btn btn-ghost" id="createDirCancelBtn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Confirm Delete Object Dialog -->
  <div id="confirmDeleteModalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="confirmDeleteTitle">
    <div class="modal" id="confirmDeleteModal" tabindex="-1">
      <div class="modal-header">
        <h3 id="confirmDeleteTitle">Confirm Delete</h3>
        <button class="btn btn-ghost" id="closeConfirmDeleteModalBtn" aria-label="Close">✕</button>
      </div>
      <div id="confirmDeleteBody"></div>
      <div class="modal-actions">
        <button class="btn btn-destructive" id="confirmDeleteBtn">Delete</button>
        <button class="btn btn-ghost" id="confirmDeleteCancelBtn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Delete Directory Modal -->
  <div id="deleteDirModalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="deleteDirTitle">
    <div class="modal" id="deleteDirModal" tabindex="-1">
      <div class="modal-header">
        <h3 id="deleteDirTitle">Delete Directory</h3>
        <button class="btn btn-ghost" id="closeDeleteDirModalBtn" aria-label="Close">✕</button>
      </div>
      <div id="deleteDirBody">
        <p id="deleteDirCount">Preparing…</p>
        <div id="deleteDirKeyList" class="card" hidden>
          <h4>Objects to delete</h4>
          <ul id="deleteDirKeyListItems" style="max-height: 240px; overflow: auto; margin: 0; padding-left: 20px;"></ul>
        </div>
        <div class="progress" aria-label="Delete progress"><div id="deleteDirProgressBar"></div></div>
        <div id="deleteDirFailures" class="card" hidden>
          <h4>Partial Failures</h4>
          <ul id="deleteDirFailureList"></ul>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-destructive" id="deleteDirConfirmBtn">Delete All</button>
        <button class="btn btn-secondary" id="deleteDirRetryBtn" hidden>Retry Failed</button>
        <button class="btn btn-ghost" id="deleteDirCancelBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Move Picker Modal -->
  <div id="movePickerModalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="movePickerTitle">
    <div class="modal" id="movePickerModal" tabindex="-1">
      <div class="modal-header">
        <h3 id="movePickerTitle">Move Items</h3>
        <button class="btn btn-ghost" id="closeMovePickerModalBtn" aria-label="Close">✕</button>
      </div>
      <div id="movePickerBreadcrumbs" class="breadcrumbs" aria-label="Move destination"></div>
      <div id="movePickerPrefixList" class="list" role="table" aria-label="Destination prefixes"></div>
      <div class="modal-actions">
        <button class="btn btn-primary" id="movePickerSelectBtn">Select Destination</button>
        <button class="btn btn-ghost" id="movePickerCancelBtn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Move Confirm Modal -->
  <div id="moveConfirmModalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="moveConfirmTitle">
    <div class="modal" id="moveConfirmModal" tabindex="-1">
      <div class="modal-header">
        <h3 id="moveConfirmTitle">Move</h3>
        <button class="btn btn-ghost" id="closeMoveConfirmModalBtn" aria-label="Close">✕</button>
      </div>
      <div id="moveConfirmBody">
        <p id="moveConfirmSummary">Preparing…</p>
        <div id="moveConflictsCard" class="card" hidden>
          <h4>Conflicts</h4>
          <ul id="moveConflictList" style="max-height: 240px; overflow: auto; margin: 0; padding-left: 20px;"></ul>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-primary" id="moveConfirmOverwriteBtn">Overwrite and Move</button>
        <button class="btn btn-secondary" id="moveConfirmBackBtn">Back</button>
        <button class="btn btn-ghost" id="moveConfirmCancelBtn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Move Progress Modal -->
  <div id="moveProgressModalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="moveProgressTitle">
    <div class="modal" id="moveProgressModal" tabindex="-1">
      <div class="modal-header">
        <h3 id="moveProgressTitle">Move Progress</h3>
        <button class="btn btn-ghost" id="closeMoveProgressModalBtn" aria-label="Close">✕</button>
      </div>
      <div id="moveProgressBody">
        <p id="moveProgressCount">Preparing…</p>
        <div class="progress" aria-label="Move progress"><div id="moveProgressBar"></div></div>
        <div id="moveFailures" class="card" hidden>
          <h4>Partial Failures</h4>
          <ul id="moveFailureList"></ul>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="moveRetryFailedBtn" hidden>Retry Failed</button>
        <button class="btn btn-ghost" id="moveProgressCancelBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Download Progress Modal -->
  <div id="downloadProgressModalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="downloadProgressTitle">
    <div class="modal" id="downloadProgressModal" tabindex="-1">
      <div class="modal-header">
        <h3 id="downloadProgressTitle">Download Progress</h3>
        <button class="btn btn-ghost" id="closeDownloadProgressModalBtn" aria-label="Close">✕</button>
      </div>
      <div id="downloadProgressBody">
        <p id="downloadProgressCount">Preparing…</p>
        <div class="progress" aria-label="Download progress"><div id="downloadProgressBar"></div></div>
        <div id="downloadFailures" class="card" hidden>
          <h4>Partial Failures</h4>
          <ul id="downloadFailureList"></ul>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="downloadRetryFailedBtn" hidden>Retry Failed</button>
        <button class="btn btn-ghost" id="downloadProgressCancelBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Info Requirements Modal -->
  <div id="infoModalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="infoModalTitle">
    <div class="modal modal-fullscreen" id="infoModal" tabindex="-1">
      <div class="modal-header">
        <h3 id="infoModalTitle">Requirements</h3>
        <button class="btn btn-ghost" id="closeInfoModalBtn" aria-label="Close">✕</button>
      </div>
      <div>
        <p class="helper" style="margin:0 0 12px 0;">
          To use this app, your IAM user must have permissions for ListBucket, GetObject, and PutObject on the target bucket, and the S3 bucket must have CORS enabled to allow browser access.
        </p>

        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <h4 style="margin:0;">IAM Policy</h4>
            <button class="btn btn-secondary" id="copyIamPolicyBtn">Copy</button>
          </div>
          <pre class="code-block" id="iamPolicyBlock">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowListBucket",
            "Effect": "Allow",
            "Action": [
                "s3:ListBucket",
                "s3:GetObject",
                "s3:PutObject"
            ],
            "Resource": "arn:aws:s3:::S3-BUCKET-NAME"
        }
    ]
}</pre>
        </div>

        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <h4 style="margin:0;">CORS</h4>
            <button class="btn btn-secondary" id="copyCorsBtn">Copy</button>
          </div>
          <pre class="code-block" id="corsBlock">[
    {
        "AllowedHeaders": [
            "*"
        ],
        "AllowedMethods": [
            "GET",
            "PUT",
            "POST",
            "DELETE",
            "HEAD"
        ],
        "AllowedOrigins": [
            "*"
        ],
        "ExposeHeaders": [
            "ETag"
        ],
        "MaxAgeSeconds": 3000
    }
]</pre>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn btn-ghost" id="infoCloseBtn">Close</button>
      </div>
    </div>
  </div>

  <script src="assets/js/app.js"></script>
  <script src="assets/js/banner-fade.js"></script>
</body>
</html>